<!DOCTYPE html>
<html>
<head>
    <title>Software Refactoring - Milestone 4</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
            color: #222;
            transition: 0.3s;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 40px;
        }

        .chart-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn {
            margin-top: 10px;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #007bff;
            color: white;
            font-size: 14px;
        }

        .btn:hover {
            background: #0056b3;
        }

        #darkmodeBtn {
            position: fixed;
            right: 20px;
            top: 20px;
            padding: 10px 16px;
            background: #333;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        body.dark {
            background: #1e1e1e;
            color: #f5f5f5;
        }

        body.dark .chart-box {
            background: #2b2b2b;
            box-shadow: 0 4px 20px rgba(255,255,255,0.05);
        }

        body.dark .btn {
            background: #555;
        }
    </style>
</head>
<body>

<h1>Cadence of refactoring change before vs. after a release (W1 vs W2)</h1>

<button id="darkmodeBtn">Toggle Dark Mode</button>

<div class="chart-grid">

    <div class="chart-box">
        <h2>Apache Ant</h2>
        <canvas id="antChart"></canvas>
        <button class="btn" onclick="downloadChart('antChart')">Download Chart</button>
    </div>

    <div class="chart-box">
        <h2>Apache JMeter</h2>
        <canvas id="jmeterChart"></canvas>
        <button class="btn" onclick="downloadChart('jmeterChart')">Download Chart</button>
    </div>

    <div class="chart-box">
        <h2>JFreeChart</h2>
        <canvas id="jfreeChart"></canvas>
        <button class="btn" onclick="downloadChart('jfreeChart')">Download Chart</button>
    </div>

</div>

<script>

const projects = {
    "Apache Ant": {
        versions: ["1.10.14", "1.10.15"],
        w1: [21, 0],
        w2: [0, 6]
    },
    "Apache JMeter": {
        versions: ["5.6.1", "5.6.2"],
        w1: [1308, 121],
        w2: [86, 0]
    },
    "JFreeChart": {
        versions: ["1.5.4", "1.5.5", "1.5.6"],
        w1: [3, 4, 377],
        w2: [0, 0, 56]
    }
};

function percentageChange(a, b) {
    if (a === 0 && b === 0) return "0%";
    if (a === 0) return "+âˆž%";
    return (((b - a) / a) * 100).toFixed(2) + "%";
}

function createHybridChart(canvasId, projData) {
    return new Chart(document.getElementById(canvasId), {
        type: "bar",
        data: {
            labels: projData.versions,
            datasets: [
                {
                    label: "W1 (Pre-release)",
                    data: projData.w1,
                    backgroundColor: "rgba(75,192,192,0.7)",
                    borderColor: "rgb(75,192,192)",
                    borderWidth: 2
                },
                {
                    label: "W2 (Post-release)",
                    data: projData.w2,
                    backgroundColor: "rgba(255,99,132,0.7)",
                    borderColor: "rgb(255,99,132)",
                    borderWidth: 2
                },
                {
                    type: "line",
                    label: "W2 vs W1 (%) Change",
                    data: projData.w1.map((v, i) => 
                        ((projData.w2[i] - v) / (v === 0 ? 1 : v) * 100).toFixed(1)
                    ),
                    yAxisID: 'percentage',
                    borderColor: "gold",
                    backgroundColor: "gold",
                    tension: 0.3,
                    pointRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            animation: {
                duration: 1200
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: { text: "Refactorings", display: true }
                },
                percentage: {
                    position: 'right',
                    beginAtZero: true,
                    title: { text: "% Change", display: true },
                    grid: { drawOnChartArea: false }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            if (context.dataset.label.includes("%")) {
                                return `Change: ${context.raw}%`;
                            }
                            return `${context.dataset.label}: ${context.raw}`;
                        }
                    }
                }
            }
        }
    });
}


const antChart = createHybridChart("antChart", projects["Apache Ant"]);
const jmeterChart = createHybridChart("jmeterChart", projects["Apache JMeter"]);
const jfreeChart = createHybridChart("jfreeChart", projects["JFreeChart"]);

function downloadChart(id) {
    const link = document.createElement('a');
    link.href = document.getElementById(id).toDataURL('image/png');
    link.download = id + ".png";
    link.click();
}

document.getElementById("darkmodeBtn").onclick = () => {
    document.body.classList.toggle("dark");
};
</script>

</body>
</html>
